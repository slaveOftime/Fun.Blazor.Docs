<h1 id="section">热重载</h1>
<pre><code class="language-sh">dotnet tool install --global Fun.Blazor.Cli --version 3.2.0
</code></pre>
<p>您可以安装一个模板来创建一个配置了热重载的项目：</p>
<pre><code class="language-sh">dotnet new --install Fun.Blazor.Templates::3.2.0
</code></pre>
<p><img src="Docs/assets/site-hot-reload.gif" alt="image" /></p>
<h2 id="section-1">基本步骤</h2>
<ol>
<li><p>定义一个入口点</p>
<p>您可以将一个组件作为入口点，并在组件使用位置替换为以下代码：</p>
<p>当您有多个项目时，通过为每个项目拥有多个入口点，您可以获得更好的性能。您可以使用最后一个参数来定位不同的 cli watch hosts。</p>
<pre><code class="language-fsharp">#if DEBUG       
    html.hotReloadComp(yourComponent, &quot;FullNameName.yourComponent&quot;, &quot;http://localhost:9025&quot;)
#else
    yourComponent
#endif
</code></pre>
<p>因为 <a href="https://github.com/dotnet/fsharp/issues/14250">dotnet/fsharp#14250</a> 的原因，您需要将以下目标添加到您的项目中：</p>
<pre><code class="language-xml">&lt;Target Name=&quot;ShimReferencePathsWhenCommonTargetsDoesNotUnderstandReferenceAssemblies&quot;
    BeforeTargets=&quot;CoreCompile&quot;
    Condition=&quot;'@(ReferencePathWithRefAssemblies)' == ''&quot;&gt;
    &lt;ItemGroup&gt;
        &lt;ReferencePathWithRefAssemblies Include=&quot;@(ReferencePath)&quot; /&gt;
    &lt;/ItemGroup&gt;
&lt;/Target&gt;
</code></pre>
</li>
<li><p>构建您的项目并运行。</p>
</li>
<li><p>打开终端并运行：</p>
<pre><code class="language-sh">fun-blazor watch &quot;包含入口文件的项目完整路径&quot; --server &quot;http://localhost:9025&quot;
</code></pre>
<p>默认情况下，服务器在9025端口运行，但当您有多个项目时，您可能想要使用不同的端口，并且端口应与您在入口文件中自定义的端口相同。</p>
</li>
<li><p>编辑和保存</p>
<p>导航到包含 <strong>yourComponent</strong> 的页面。此时，它将连接到 CLI 服务并开始接收更改。</p>
<p>转到定义 <strong>yourComponent</strong> 的文件，在文件顶部添加 <strong>// hot-reload</strong>，更改任何您想要更改的内容，然后保存即可。您的用户界面应相应地更新。</p>
</li>
</ol>
<h2 id="section-2">限制</h2>
<ul>
<li><p>入口文件和 <strong>yourComponent</strong> 应该定义在不同的文件中。</p>
</li>
<li><p>并非所有的 F# 表达式都能正确解析，因此最好将UI逻辑和UI布局分开到不同的文件中，只在UI布局文件中添加 <strong>// hot-reload</strong>。</p>
<p>例如，如果您想要添加一个扩展方法到IComponentHook以访问后台服务器，可以将其分离到一个新文件中。</p>
<p>文件结构可能如下：</p>
<pre><code>YourComponent
    Stores.fs
    Hooks.fs
    Control1.fs // hot-reload
    Control2.fs // hot-reload
</code></pre>
</li>
<li><p>第一次保存需要更长的时间。</p>
</li>
<li><p>要让其他定义在不同文件中的组件能够进行热重载：</p>
<ul>
<li>这些组件必须定义在同一项目中。</li>
<li>这些组件必须被 <strong>yourComponent</strong> 直接引用。</li>
<li>您还需要在包含组件的文件中添加 <strong>// hot-reload</strong>。</li>
</ul>
</li>
<li><p>由于性能问题，不应该将太多的文件启用热重载。</p>
</li>
<li><p>它不支持添加新文件、重命名文件或其他类似的操作。只支持修改现有文件。</p>
</li>
<li><p>只有在 IGlobalStore 或 IShareStore 中创建的状态才会被保留。</p>
</li>
</ul>
<blockquote>
<p>让我们一起期待F#将来能在dotnet中实现热重载。</p>
</blockquote>
