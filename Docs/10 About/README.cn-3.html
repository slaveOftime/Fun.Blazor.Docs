<h2 id="section">è¿™æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h2>
<p>Fun.Blazor ä¸º Blazor æä¾›äº†ä¸€ç³»åˆ—å§”æ‰˜è¿›è¡Œå¤„ç†ã€‚ä¾‹å¦‚ï¼Œå½“æ‚¨ç¼–å†™ï¼š</p>
<pre><code class="language-fsharp">let demo =
    div {
        class' &quot;cool&quot;
    }
</code></pre>
<p>è¿™æ®µä»£ç æœ¬è´¨ä¸Šå˜æˆäº†ï¼š</p>
<pre><code class="language-fsharp">let demo =
    NodeRenderFragment(fun comp builder index -&gt;  // å§”æ‰˜
        builder.OpenElement(index, &quot;div&quot;)
        bulder.AddAttribute(index + 1, &quot;class&quot;, &quot;cool&quot;)
        builer.CloseElement()
        index + 2
    )

type NodeRenderFragment = delegate of root: IComponent * builder: RenderTreeBuilder * sequence: int -&gt; int
</code></pre>
<p>æœ¬è´¨ä¸Šï¼Œä½ å·²ç»åˆ›å»ºäº†ä¸€ä¸ªå§”æ‰˜ï¼Œè¯¥å§”æ‰˜å°†ä¼ é€’ç»™ä¸€ä¸ªç»„ä»¶ï¼Œè¯¥ç»„ä»¶å°†ç®¡ç† DOM æ ‘çš„æ¸²æŸ“æˆ–æ„å»ºã€‚è¿™ç§æ–¹æ³•ç±»ä¼¼äº Razor å¼•æ“åœ¨ C# ä¸–ç•Œä¸­ç”Ÿæˆçš„å†…å®¹ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨ <code>adaptiview</code>ã€<code>html.inject</code> ç­‰åˆ›å»ºç»„ä»¶ã€‚è¿™äº›ç»„ä»¶æ˜¯ä» <code>ComponentBase</code> ç»§æ‰¿çš„æ™®é€š Blazor ç»„ä»¶ã€‚</p>
<h2 id="fun.blazor">åœ¨ä½¿ç”¨ Fun.Blazor ä¹‹å‰è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š</h2>
<ol>
<li><p>F# ç¼–è¯‘å™¨åœ¨æŸäº›å¤§å‹è®¡ç®—è¡¨è¾¾å¼ (CE) çš„æ™ºèƒ½æç¤ºæ–¹é¢å­˜åœ¨æ€§èƒ½é—®é¢˜ã€‚æœ€å¥½å‡å°å•ä¸ª CE å—æˆ–æ–‡ä»¶ï¼Œæˆ–ä½¿ç”¨ <code>seq</code>ã€<code>list</code> æˆ– <code>array</code> ä¸ <code>childContent</code> ä»¥è·å¾—æ›´å¥½çš„æ™ºèƒ½æç¤ºæ•ˆæœï¼š</p>
<p>There are some tests in <a href="https://github.com/albertwoo/CEPerfDemo">here</a>, in summary, below are some recommend ways for better build time performance (but it can reduce runtime performance because we cannot inline and need to allocate memory on head for creating array or list)</p>
<ul>
<li><p>The best result is <strong>list-with-local-vars</strong> for multiple child items</p>
<pre><code class="language-fsharp">let demo1 = div {
    class' &quot;font-bold&quot;
    &quot;demo1&quot;
}

let demo2 = div {
    class' &quot;font-bold&quot;
    &quot;demo2&quot;
}

let comp = div {
    style { color &quot;red&quot; }
    childContent [| // ğŸ‘Œâœ…
        demo1
        demo2
    |]
}
</code></pre>
</li>
<li><p><strong>nested-one</strong> is ok</p>
<pre><code class="language-fsharp">let comp = div {
    class' &quot;font-bold&quot;
    div { // ğŸ‘Œâœ…
        class' &quot;font-bold&quot;
        div { &quot;demo1&quot; }
    }
}
</code></pre>
</li>
<li><p><strong>nested-one-one</strong> is not ok (bad for build perf)</p>
<pre><code class="language-fsharp">let comp = div {
    class' &quot;font-bold&quot;
    div {
        class' &quot;font-bold&quot;
        div { // â›”ğŸ™…
            class' &quot;font-bold&quot;
            div { &quot;demo1&quot; }
        }
    }
}
</code></pre>
</li>
<li><p>inline local vars is not ok (bad for build perf)</p>
<pre><code class="language-fsharp">let comp = div {
    class' &quot;font-bold&quot;
    let temp = div { // â›”ğŸ™…
        class' &quot;font-bold&quot;
        &quot;demo1&quot;
    }
    temp
}
</code></pre>
</li>
</ul>
</li>
<li><p>çƒ­é‡è½½</p>
<p>é»˜è®¤çš„æ¨¡æ¿å·²æä¾›æœ‰é™çš„çƒ­é‡è½½æ”¯æŒã€‚ åœ¨è¿‡å¤šçš„æ–‡ä»¶æƒ…å†µä¸‹ä¼šå‡æ…¢çƒ­é‡è½½è¿‡ç¨‹ï¼Œå› æ­¤ä¸ºäº†å–å¾—æœ€ä½³æ•ˆæœï¼Œåº”åœ¨æƒ³å¯ç”¨çƒ­é‡è½½çš„æ–‡ä»¶é¡¶éƒ¨æ·»åŠ  <code>// hot-reload</code> ã€‚æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ <a href="https://www.slaveoftime.fun/blog/d959e36a-f4fe-4a10-88af-5e738633db0f?title=%20Hot-reload%20in%20Fun.Blazor">Fun.Blazor çƒ­é‡è½½</a> åšå®¢æ–‡ç« æˆ– <a href="https://slaveoftime.github.io/Fun.Blazor.Docs/?doc=/Hot%20Reload">æ–‡æ¡£</a>.</p>
</li>
<li><p>å¯¹äºç»„ä»¶å…ƒç´ ä¸­çš„å±æ€§å’Œå­å…ƒç´ ï¼Œæœ€å¥½æŒ‰ä»¥ä¸‹æ–¹å¼æ’åˆ—ï¼š</p>
<pre><code class="language-fsharp">div {
    attributes ...
    ref (fun x -&gt; ()) // âœ…
    childContent [ ... ]
}
</code></pre>
<p>æˆ–è€…ï¼š</p>
<pre><code class="language-fsharp">div {
    attributes ...
    ref (fun x -&gt; ()) // âœ…
    div { 1 }
    div { 1 }
    // ...
}
</code></pre>
</li>
</ol>
<h2 id="section-1">åŸºå‡†æµ‹è¯•</h2>
<p>BenchmarkDotNet v0.13.12, Windows 11 (10.0.22631.3007/23H2/2023Update/SunValley3)
12th Gen Intel Core i7-12700H, 1 CPU, 20 logical and 14 physical cores
.NET SDK 8.0.100
[Host]     : .NET 8.0.1 (8.0.123.58001), X64 RyuJIT AVX2 DEBUG
DefaultJob : .NET 8.0.1 (8.0.123.58001), X64 RyuJIT AVX2</p>
<table>
<thead>
<tr>
<th>Method</th>
<th style="text-align: right;">Mean</th>
<th style="text-align: right;">Error</th>
<th style="text-align: right;">StdDev</th>
<th style="text-align: right;">Ratio</th>
<th style="text-align: right;">RatioSD</th>
<th style="text-align: right;">Gen0</th>
<th style="text-align: right;">Allocated</th>
<th style="text-align: right;">Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>RenderWithRazorCSharp</td>
<td style="text-align: right;">234.1 ns</td>
<td style="text-align: right;">3.59 ns</td>
<td style="text-align: right;">3.36 ns</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.0298</td>
<td style="text-align: right;">376 B</td>
<td style="text-align: right;">1.00</td>
</tr>
<tr>
<td>RenderWithFunBlazorInlineCE</td>
<td style="text-align: right;">363.5 ns</td>
<td style="text-align: right;">4.14 ns</td>
<td style="text-align: right;">3.67 ns</td>
<td style="text-align: right;">1.55</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.0443</td>
<td style="text-align: right;">560 B</td>
<td style="text-align: right;">1.49</td>
</tr>
<tr>
<td>RenderWithFunBlazorArray</td>
<td style="text-align: right;">499.0 ns</td>
<td style="text-align: right;">9.82 ns</td>
<td style="text-align: right;">10.91 ns</td>
<td style="text-align: right;">2.14</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.1154</td>
<td style="text-align: right;">1448 B</td>
<td style="text-align: right;">3.85</td>
</tr>
<tr>
<td>RenderWithBolero</td>
<td style="text-align: right;">507.9 ns</td>
<td style="text-align: right;">9.74 ns</td>
<td style="text-align: right;">11.21 ns</td>
<td style="text-align: right;">2.17</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.1173</td>
<td style="text-align: right;">1480 B</td>
<td style="text-align: right;">3.94</td>
</tr>
</tbody>
</table>
